# 予約システム仕様書 - 改良版

## システム構成・技術スタック

### プラットフォーム・言語
* **プラットフォーム**: Vercel
* **言語/FW**: TypeScript/Next.js 14 (App Router)
* **データベース**: Vercel Postgres / PostgreSQL
* **認証**: NextAuth.js
* **メール送信**: Resend
* **UI/スタイリング**: Tailwind CSS + Headless UI
* **バリデーション**: Zod + React Hook Form
* **状態管理**: Zustand
* **日付操作**: date-fns

## 基本的な機能

### 管理者機能（/admin）

#### 🔐 認証・ログイン
* **ログイン画面**: 管理者ID・パスワードでのログイン
* **セッション管理**: 自動ログアウト、セキュアなセッション管理
* **パスワード暗号化**: bcrypt使用

#### 📊 ダッシュボード（/admin/dashboard）
* **今日の予約状況**: 当日の予約一覧・空き状況
* **予約統計**: 月間予約数、人気の時間帯、プラン別統計
* **最近のアクティビティ**: 新規予約・キャンセル履歴

#### 📅 予約管理（/admin/reservations）
* **予約一覧**: 
  * 日付・時間・プラン・顧客名での検索・フィルタリング
  * 予約状況（確定・キャンセル）での絞り込み
  * CSVエクスポート機能
* **予約詳細・編集**:
  * 予約内容の確認・変更
  * 顧客情報の編集
  * 予約ステータス変更（確定↔キャンセル）
* **予約登録**: 
  * 予約者ページへのリンク
  * 管理者による代理予約入力
* **予約受付停止設定**:
  * 月の各日の11:00−21:00の１時間枠ごとに予約停止設定
  * 一括設定：７日間、１４日間の連続停止
  * 停止理由の記録（休業・メンテナンスなど）

#### 📋 プラン管理（/admin/plans）
* **プラン一覧**: アクティブ・非アクティブプランの管理
* **プラン編集**:
  * プラン名変更：予約フォームで表示されるメニュー名
  * 例：「【ご新規様限定】2回券 29,800円（税込）」
  * プラン説明文・詳細の設定
* **プラン追加・削除**: 新プランの追加、既存プランの無効化

#### 👥 管理者情報（/admin/users）
* **管理者一覧**: 
  * 管理者のログインID確認
  * アカウント有効・無効状態の管理
* **管理者追加**: 
  * 新しい管理者のログインID・パスワード設定
  * アカウント権限設定
* **管理者編集**: 既存管理者の情報変更・パスワードリセット

#### 👤 顧客管理（/admin/customers） ※新機能
* **顧客一覧**: 過去の予約履歴を持つ顧客リスト
* **顧客詳細**: 個別顧客の予約履歴・連絡先情報
* **リピート顧客の特定**: 複数回利用のお客様の管理

### 予約機能（/reserve）

#### Step1: 日時を選ぶ
* **希望メニュー選択**: 
  * アクティブなプランからドロップダウンで選択
  * プラン詳細・価格の表示
* **カレンダー表示**:
  * １週間単位の枠表示
  * 「次の週」「前の週」ボタンで最大１ヶ月分の週次表示
  * 予約可能・不可能な時間の視覚的区別
  * リアルタイムの空き状況反映

#### Step2: お客様情報入力
* **必須項目**:
  * お名前（必須）- 文字数制限・形式チェック
  * 電話番号（必須）- バリデーション（ハイフンあり/なし対応）
  * メールアドレス（必須）- 形式バリデーション・重複チェック
* **任意項目**:
  * ご要望・備考欄（自由記述）
* **入力支援**: リアルタイムバリデーション・エラー表示

#### Step3: 入力内容確認画面
* **確認表示項目**:
  * プラン名
  * 予約日時（曜日表示含む）
  * お名前
  * 電話番号
  * メールアドレス
  * ご要望
* **アクションボタン**:
  * **予約する**: 
    * 予約完了処理・データベース保存
    * 顧客・管理者への自動メール送信
    * 予約完了画面への遷移
  * **修正する**: Step2に戻る
  * **最初からやり直す**: Step1に遷移

#### Step4: 予約完了（/reserve/complete） ※新機能
* **完了メッセージ表示**
* **予約内容の最終確認**
* **注意事項・連絡先の表示**
* **予約確認メールの送信通知**

### 予約者向け追加機能 ※新機能

#### 🔍 予約確認（/reserve/check）
* **予約番号・メールアドレスでの照会**
* **予約内容の確認表示**
* **予約変更・キャンセルリンク**

#### ✏️ 予約変更（/reserve/modify）
* **日時変更**: 空いている時間への変更
* **顧客情報変更**: 連絡先等の更新
* **要望追加**: 後からの要望・変更事項入力

#### ❌ 予約キャンセル（/reserve/cancel）
* **キャンセル理由の入力**
* **キャンセル確認メールの自動送信**
* **管理者への通知**

## 📧 メール機能

### 自動送信メール
* **予約完了メール**: 顧客への予約確認
* **管理者通知メール**: 新規予約の管理者向け通知
* **変更・キャンセル通知**: 予約変更時の双方向通知
* **リマインダーメール**: 予約日前日の自動通知（オプション）

### メールテンプレート
* **HTMLメール対応**: レスポンシブデザイン
* **カスタマイズ可能**: 店舗情報・ロゴの挿入
* **多言語対応準備**: 将来的な英語対応

## 🛡️ セキュリティ・信頼性

### データ保護
* **SSL/TLS暗号化**: 全通信の暗号化
* **個人情報の適切な管理**: GDPR準拠のデータ処理
* **定期バックアップ**: Vercel Postgresの自動バックアップ

### システム監視
* **エラー監視**: リアルタイムエラートラッキング
* **パフォーマンス監視**: レスポンス時間・稼働率の監視
* **ログ管理**: セキュリティイベントの記録

## 📱 レスポンシブ対応

### デバイス対応
* **スマートフォン**: iOSとAndroid最適化
* **タブレット**: iPadなどの中型デバイス
* **デスクトップ**: 管理画面の快適な操作環境

### UX/UI設計
* **直感的な操作**: ユーザーフレンドリーなインターフェース
* **アクセシビリティ**: 高齢者・障がい者への配慮
* **ローディング状態**: 処理中の適切なフィードバック

## 🚀 デプロイメント・運用

### 本番環境
* **Vercel**: 自動デプロイ・CDN・SSL証明書
* **カスタムドメイン**: 独自ドメインでの運用
* **環境変数管理**: 本番・開発環境の分離

### 監視・メンテナンス
* **稼働監視**: Uptime monitoring
* **定期メンテナンス**: システム更新・セキュリティパッチ
* **データ分析**: Google Analytics連携（オプション）

## 📈 将来の拡張予定

### Phase 2 機能
* **決済機能**: Stripe連携での事前決済
* **多店舗対応**: 複数拠点の管理
* **スタッフ管理**: 担当者別のスケジュール管理
* **顧客ポイントシステム**: リピーター向け特典

### Phase 3 機能
* **モバイルアプリ**: ネイティブアプリ開発
* **AI チャットボット**: 自動問い合わせ対応
* **レビュー・評価システム**: 顧客フィードバック収集
* **多言語対応**: 訪日外国人向け予約対応